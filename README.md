# Project Harimau üêØ
> Documents are generated by AI (Primarily Gemini, occasionally Claude). Some human intervention was used for accuracy and guiding of AI. 
> This is a work in progress and is not intended for production use.

**AI-Powered Threat Intelligence Analysis Platform**

Project Harimau is an automated threat intelligence investigation system that analyzes IOCs from Google Threat Intelligence (GTI). Using a graph-based multi-agent architecture (LangGraph), it mimics how threat intelligence analysts work: systematically analyzing malware, mapping infrastructure, and synthesizing findings into actionable intelligence reports.

## How it works

The application takes an IOC (like a file hash, URL, or IP address) and kicks off an investigation. Specialist AI Agents work together to analyze the IOC, gather threat intelligence, and produce a report with their findings.

## Architecture
* **Frontend**: Streamlit (Cloud Run Service) - Interactive investigation dashboard
* **Backend**: FastAPI + LangGraph (Cloud Run Service) - Multi-agent orchestration
* **MCP**: Embedded GTI Server (stdio/Direct API) - Direct connection to threat intelligence
* **Brain**: Gemini 2.5 Flash / Pro - Powered by advanced AI reasoning
* **Investigation Cache**: NetworkX (in-memory graph per investigation)

## Core Capabilities
* **Automated Malware Analysis**: Deep behavioral analysis, capability assessment, and attribution tracking
* **Infrastructure Mapping**: Comprehensive DNS, IP, and hosting infrastructure analysis with pivot detection
* **Intelligence Synthesis**: Lead analyst agent correlates findings across malware and infrastructure domains
* **Rich Visualization**: Interactive knowledge graphs with threat scores, relationships, and entity details
* **Research Pivots**: Identifies intelligence gaps and suggests next research steps
* **Campaign Tracking**: Links IOCs to known threat actors and campaigns

## üöÄ Deployment (GCP)
1. **Prerequisites**: `gcloud` CLI installed and authenticated.
2. **Configuration**:
   ```bash
   # Export your GTI API Key (saved to Secret Manager)
   export GTI_API_KEY="your_actual_key_here"
   ```
3. **Deploy**:
   ```bash
   ./deploy.sh [backend|frontend|all]
   ```
   - **Default**: Deploys both.
   - **Backend only**: `./deploy.sh backend`
   - **Frontend only**: `./deploy.sh frontend`

4. **Verify**:
   ```bash
   curl -X POST "https://harimau-backend-<PROJECT_ID>.asia-southeast1.run.app/api/investigate" \
        -H "Content-Type: application/json" \
        -d '{"ioc": "<sha256>>"}'
   ```

## üìä Status
-   **Phase 1 (Infrastructure)**: ‚úÖ Complete
-   **Phase 2 (The Brain)**: ‚úÖ Complete
-   **Phase 3 (Interface)**: ‚úÖ Complete
-   **Phase 4 (Hybrid Triage + Token Optimization)**: ‚úÖ Complete
-   **Phase 5 (Enhanced Visualization + NetworkX Cache)**: ‚úÖ Complete
-   **Phase 6 (Threat Intelligence Refinement)**: ‚úÖ Complete (Feb 2026)

### üõ†Ô∏è Code Quality Overhaul
-   **Robustness**: Consolidated state, deep-merge cache deduplication, and specific exception handling.
-   **Reliability**: Dual-fallback JSON parsing and guaranteed format delivery.
-   **Efficiency**: Parallel specialist execution with iterative synthesis.

## Architecture Principles

### Multi-Agent Intelligence Workflow
1. **Triage Agent**: Initial IOC assessment and investigation planning (breadth-first)
2. **Specialist Agents**: Deep analysis in parallel
   - **Malware Specialist**: Behavioral analysis, capability assessment, attribution
   - **Infrastructure Specialist**: Network mapping, hosting analysis, pivot detection
3. **Lead Hunter**: Cross-domain synthesis and intelligence report generation

### Data Flow
1. **Fetch Full**: Agents fetch complete entity data from various tools ()
2. **Store All**: Full attributes cached in NetworkX graph (LangGraph state)
3. **Query Minimal**: LLM receives filtered summaries (token-efficient)
4. **Enrich On-Demand**: Specialists pull from cache (no re-fetch)
5. **Synthesize**: Lead Hunter correlates findings into actionable intelligence

### Agent Philosophy
- **Triage**: Quick assessment, relationship discovery
- **Specialists**: Deep domain expertise, intelligence gathering
- **Lead Hunter**: Strategic synthesis, campaign tracking, and iterative investigation (2 rounds)
- **OSINT Agent**: Helps with OSINT research / Attribution
- **Detection Agent**: Helps with detection engineering and creation of hunt package
- **SOC Agent**: Connects to SIEM and SOAR platforms to hunt internally with the help of the hunt package (Might combine with Detection Agent)

## Documentation
* [Product Requirements (PRD)](docs/PRD.md)
* [Architecture Proposal](docs/architecture.md)
* [Implementation Plan](docs/implementation_plan.md)

## Technology Stack
- **Orchestration**: LangGraph
- **API**: FastAPI
- **UI**: Streamlit
- **LLM**: Vertex AI (Gemini 2.5)
- **Cache**: NetworkX (in-memory)
- **Deployment**: Google Cloud Run
- **Secrets**: Google Secret Manager
